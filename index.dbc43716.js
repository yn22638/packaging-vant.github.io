import{T as e,x as t,e as n,g as o,ag as a,at as s,v as l,n as i,aP as u,A as r,aa as c,G as d,au as m,ak as f,j as p,b as v,p as h,O as x,f as g,s as b,m as y,ai as I,i as C,ab as w,L as H,t as T,aQ as N,aY as V}from"./index.efe4ebdd.js";function k(n){if(!e(n))return n;if(Array.isArray(n))return n.map((e=>k(e)));if(t(n)){const e={};return Object.keys(n).forEach((t=>{e[t]=k(n[t])})),e}return n}const[O,S]=n("picker-column");const B=Symbol(O),D=e=>t(e)&&e.disabled;var M=o({name:O,props:{textKey:a(String),readonly:Boolean,allowHtml:Boolean,className:s,itemHeight:a(Number),defaultIndex:l(0),swipeDuration:a(i),initialOptions:u(),visibleItemCount:a(i)},emits:["change"],setup(e,{emit:n,slots:o}){let a,s,l,i,u;const g=r(),b=c({index:e.defaultIndex,offset:0,duration:0,options:k(e.initialOptions)}),y=d(),I=()=>b.options.length,C=()=>e.itemHeight*(+e.visibleItemCount-1)/2,w=(t,o)=>{const s=-(t=(e=>{for(let t=e=x(e,0,I());t<I();t++)if(!D(b.options[t]))return t;for(let t=e-1;t>=0;t--)if(!D(b.options[t]))return t})(t)||0)*e.itemHeight,l=()=>{t!==b.index&&(b.index=t,o&&n("change",t))};a&&s!==b.offset?u=l:l(),b.offset=s},H=t=>{JSON.stringify(t)!==JSON.stringify(b.options)&&(b.options=k(t),w(e.defaultIndex))},T=n=>t(n)&&e.textKey in n?n[e.textKey]:n,N=t=>x(Math.round(-t/e.itemHeight),0,I()-1),V=()=>{a=!1,b.duration=0,u&&(u(),u=null)},O=t=>{if(!e.readonly){if(y.start(t),a){const e=function(e){const{transform:t}=window.getComputedStyle(e),n=t.slice(7,t.length-1).split(", ")[5];return Number(n)}(g.value);b.offset=Math.min(0,e-C()),s=b.offset}else s=b.offset;b.duration=0,l=Date.now(),i=s,u=null}},M=t=>{if(e.readonly)return;y.move(t),y.isVertical()&&(a=!0,h(t,!0)),b.offset=x(s+y.deltaY.value,-I()*e.itemHeight,e.itemHeight);const n=Date.now();n-l>300&&(l=n,i=b.offset)},j=()=>{if(e.readonly)return;const t=b.offset-i,n=Date.now()-l;if(n<300&&Math.abs(t)>15)return void((t,n)=>{const o=Math.abs(t/n);t=b.offset+o/.003*(t<0?-1:1);const a=N(t);b.duration=+e.swipeDuration,w(a,!0)})(t,n);const o=N(b.offset);b.duration=200,w(o,!0),setTimeout((()=>{a=!1}),0)},K=()=>{const t={height:`${e.itemHeight}px`};return b.options.map(((n,s)=>{const l=T(n),i=D(n),r={role:"button",style:t,tabindex:i?-1:0,class:S("item",{disabled:i,selected:s===b.index}),onClick:()=>(t=>{a||e.readonly||(u=null,b.duration=200,w(t,!0))})(s)},c={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return v("li",r,[o.option?o.option(n):v("div",c,null)])}))};return w(b.index),m(B),f({state:b,setIndex:w,getValue:()=>b.options[b.index],setValue:e=>{const{options:t}=b;for(let n=0;n<t.length;n++)if(T(t[n])===e)return w(n)},setOptions:H,stopMomentum:V}),p((()=>e.initialOptions),H),p((()=>e.defaultIndex),(e=>w(e))),()=>v("div",{class:[S(),e.className],onTouchstart:O,onTouchmove:M,onTouchend:j,onTouchcancel:j},[v("ul",{ref:g,style:{transform:`translate3d(0, ${b.offset+C()}px, 0)`,transitionDuration:`${b.duration}ms`,transitionProperty:b.duration?"all":"none"},class:S("wrapper"),onTransitionend:V},[K()])])}});const[j,K,$]=n("picker"),P={title:String,loading:Boolean,readonly:Boolean,allowHtml:Boolean,itemHeight:b(44),showToolbar:T,swipeDuration:b(1e3),visibleItemCount:b(6),cancelButtonText:String,confirmButtonText:String};var E=o({name:j,props:g({},P,{columns:u(),valueKey:String,defaultIndex:b(0),toolbarPosition:y("top"),columnsFieldNames:Object}),emits:["confirm","cancel","change"],setup(e,{emit:t,slots:n}){const o=r(!1),a=r([]),{text:s,values:l,children:i}=g({text:e.valueKey||"text",values:"values",children:"children"},e.columnsFieldNames),{children:u,linkChildren:c}=I(B);c();const d=C((()=>w(e.itemHeight))),m=C((()=>{const t=e.columns[0];if("object"==typeof t){if(i in t)return"cascade";if(l in t)return"object"}return"plain"})),x=()=>u.map((e=>e.state.index)),b=(e,t)=>{const n=u[e];n&&(n.setOptions(t),o.value=!0)},y=t=>{let n={[i]:e.columns};const o=x();for(let e=0;e<=t;e++)n=n[i][o[e]];for(;n&&n[i];)t++,b(t,n[i]),n=n[i][n.defaultIndex||0]},T=e=>u[e],k=e=>{const t=T(e);if(t)return t.getValue()},O=(e,t)=>{const n=T(e);n&&(n.setValue(t),"cascade"===m.value&&y(e))},S=e=>{const t=T(e);if(t)return t.state.index},D=(e,t)=>{const n=T(e);n&&(n.setIndex(t),"cascade"===m.value&&y(e))},j=()=>u.map((e=>e.getValue())),P=e=>{"plain"===m.value?t(e,k(0),S(0)):t(e,j(),x())},E=()=>{u.forEach((e=>e.stopMomentum())),P("confirm")},A=()=>P("cancel"),F=()=>{const t=e.cancelButtonText||$("cancel");return v("button",{type:"button",class:[K("cancel"),N],onClick:A},[n.cancel?n.cancel():t])},J=()=>{const t=e.confirmButtonText||$("confirm");return v("button",{type:"button",class:[K("confirm"),N],onClick:E},[n.confirm?n.confirm():t])},L=()=>{if(e.showToolbar){const t=n.toolbar||n.default;return v("div",{class:K("toolbar")},[t?t():[F(),n.title?n.title():e.title?v("div",{class:[K("title"),"van-ellipsis"]},[e.title]):void 0,J()]])}},Y=()=>a.value.map(((o,a)=>{var i;return v(M,{textKey:s,readonly:e.readonly,allowHtml:e.allowHtml,className:o.className,itemHeight:d.value,defaultIndex:null!=(i=o.defaultIndex)?i:+e.defaultIndex,swipeDuration:e.swipeDuration,initialOptions:o[l],visibleItemCount:e.visibleItemCount,onChange:()=>(e=>{"cascade"===m.value&&y(e),"plain"===m.value?t("change",k(0),S(0)):t("change",j(),e)})(a)},{option:n.option})})),z=e=>{if(o.value){const t={height:`${d.value}px`},n={backgroundSize:`100% ${(e-d.value)/2}px`};return[v("div",{class:K("mask"),style:n},null),v("div",{class:[V,K("frame")],style:t},null)]}},G=()=>{const t=d.value*+e.visibleItemCount,n={height:`${t}px`};return v("div",{class:K("columns"),style:n,onTouchmove:h},[Y(),z(t)])};return p((()=>e.columns),(()=>{const{columns:t}=e;"plain"===m.value?a.value=[{[l]:t}]:"cascade"===m.value?(()=>{var t;const n=[];let o={[i]:e.columns};for(;o&&o[i];){const a=o[i];let s=null!=(t=o.defaultIndex)?t:+e.defaultIndex;for(;a[s]&&a[s].disabled;){if(!(s<a.length-1)){s=0;break}s++}n.push({[l]:o[i],className:o.className,defaultIndex:s}),o=a[s]}a.value=n})():a.value=t,o.value=a.value.some((e=>e[l]&&0!==e[l].length))}),{immediate:!0}),f({confirm:E,getValues:j,setValues:e=>{e.forEach(((e,t)=>{O(t,e)}))},getIndexes:x,setIndexes:e=>{e.forEach(((e,t)=>{D(t,e)}))},getColumnIndex:S,setColumnIndex:D,getColumnValue:k,setColumnValue:O,getColumnValues:e=>{const t=T(e);if(t)return t.state.options},setColumnValues:b}),()=>{var t,o;return v("div",{class:K()},["top"===e.toolbarPosition?L():null,e.loading?v(H,{class:K("loading")},null):null,null==(t=n["columns-top"])?void 0:t.call(n),G(),null==(o=n["columns-bottom"])?void 0:o.call(n),"bottom"===e.toolbarPosition?L():null])}}});export{P as p,E as s};
