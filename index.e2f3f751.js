import{T as t,x as e,e as n,g as o,ag as a,at as s,v as l,n as i,aP as u,A as r,aa as c,G as d,au as m,ak as f,j as p,b as v,p as h,O as x,f as g,s as b,m as y,ai as I,i as C,ab as w,L as H,t as T,aQ as N,aY as V}from"./index.1816fb2f.js";function k(n){if(!t(n))return n;if(Array.isArray(n))return n.map((t=>k(t)));if(e(n)){const t={};return Object.keys(n).forEach((e=>{t[e]=k(n[e])})),t}return n}const[O,S]=n("picker-column");const B=Symbol(O),D=t=>e(t)&&t.disabled;var M=o({name:O,props:{textKey:a(String),readonly:Boolean,allowHtml:Boolean,className:s,itemHeight:a(Number),defaultIndex:l(0),swipeDuration:a(i),initialOptions:u(),visibleItemCount:a(i)},emits:["change"],setup(t,{emit:n,slots:o}){let a,s,l,i,u;const g=r(),b=c({index:t.defaultIndex,offset:0,duration:0,options:k(t.initialOptions)}),y=d(),I=()=>b.options.length,C=()=>t.itemHeight*(+t.visibleItemCount-1)/2,w=(e,o)=>{const s=-(e=(t=>{for(let e=t=x(t,0,I());e<I();e++)if(!D(b.options[e]))return e;for(let e=t-1;e>=0;e--)if(!D(b.options[e]))return e})(e)||0)*t.itemHeight,l=()=>{e!==b.index&&(b.index=e,o&&n("change",e))};a&&s!==b.offset?u=l:l(),b.offset=s},H=e=>{JSON.stringify(e)!==JSON.stringify(b.options)&&(b.options=k(e),w(t.defaultIndex))},T=n=>e(n)&&t.textKey in n?n[t.textKey]:n,N=e=>x(Math.round(-e/t.itemHeight),0,I()-1),V=()=>{a=!1,b.duration=0,u&&(u(),u=null)},O=e=>{if(!t.readonly){if(y.start(e),a){const t=function(t){const{transform:e}=window.getComputedStyle(t),n=e.slice(7,e.length-1).split(", ")[5];return Number(n)}(g.value);b.offset=Math.min(0,t-C()),s=b.offset}else s=b.offset;b.duration=0,l=Date.now(),i=s,u=null}},M=e=>{if(t.readonly)return;y.move(e),y.isVertical()&&(a=!0,h(e,!0)),b.offset=x(s+y.deltaY.value,-I()*t.itemHeight,t.itemHeight);const n=Date.now();n-l>300&&(l=n,i=b.offset)},j=()=>{if(t.readonly)return;const e=b.offset-i,n=Date.now()-l;if(n<300&&Math.abs(e)>15)return void((e,n)=>{const o=Math.abs(e/n);e=b.offset+o/.003*(e<0?-1:1);const a=N(e);b.duration=+t.swipeDuration,w(a,!0)})(e,n);const o=N(b.offset);b.duration=200,w(o,!0),setTimeout((()=>{a=!1}),0)},K=()=>{const e={height:`${t.itemHeight}px`};return b.options.map(((n,s)=>{const l=T(n),i=D(n),r={role:"button",style:e,tabindex:i?-1:0,class:S("item",{disabled:i,selected:s===b.index}),onClick:()=>(e=>{a||t.readonly||(u=null,b.duration=200,w(e,!0))})(s)},c={class:"van-ellipsis",[t.allowHtml?"innerHTML":"textContent"]:l};return v("li",r,[o.option?o.option(n):v("div",c,null)])}))};return w(b.index),m(B),f({state:b,setIndex:w,getValue:()=>b.options[b.index],setValue:t=>{const{options:e}=b;for(let n=0;n<e.length;n++)if(T(e[n])===t)return w(n)},setOptions:H,stopMomentum:V}),p((()=>t.initialOptions),H),p((()=>t.defaultIndex),(t=>w(t))),()=>v("div",{class:[S(),t.className],onTouchstart:O,onTouchmove:M,onTouchend:j,onTouchcancel:j},[v("ul",{ref:g,style:{transform:`translate3d(0, ${b.offset+C()}px, 0)`,transitionDuration:`${b.duration}ms`,transitionProperty:b.duration?"all":"none"},class:S("wrapper"),onTransitionend:V},[K()])])}});const[j,K,$]=n("picker"),P={title:String,loading:Boolean,readonly:Boolean,allowHtml:Boolean,itemHeight:b(44),showToolbar:T,swipeDuration:b(1e3),visibleItemCount:b(6),cancelButtonText:String,confirmButtonText:String};var E=o({name:j,props:g({},P,{columns:u(),valueKey:String,defaultIndex:b(0),toolbarPosition:y("top"),columnsFieldNames:Object}),emits:["confirm","cancel","change"],setup(t,{emit:e,slots:n}){const o=r(!1),a=r([]),{text:s,values:l,children:i}=g({text:t.valueKey||"text",values:"values",children:"children"},t.columnsFieldNames),{children:u,linkChildren:c}=I(B);c();const d=C((()=>w(t.itemHeight))),m=C((()=>{const e=t.columns[0];if("object"==typeof e){if(i in e)return"cascade";if(l in e)return"object"}return"plain"})),x=()=>u.map((t=>t.state.index)),b=(t,e)=>{const n=u[t];n&&(n.setOptions(e),o.value=!0)},y=e=>{let n={[i]:t.columns};const o=x();for(let t=0;t<=e;t++)n=n[i][o[t]];for(;n&&n[i];)e++,b(e,n[i]),n=n[i][n.defaultIndex||0]},T=t=>u[t],k=t=>{const e=T(t);if(e)return e.getValue()},O=(t,e)=>{const n=T(t);n&&(n.setValue(e),"cascade"===m.value&&y(t))},S=t=>{const e=T(t);if(e)return e.state.index},D=(t,e)=>{const n=T(t);n&&(n.setIndex(e),"cascade"===m.value&&y(t))},j=()=>u.map((t=>t.getValue())),P=t=>{"plain"===m.value?e(t,k(0),S(0)):e(t,j(),x())},E=()=>{u.forEach((t=>t.stopMomentum())),P("confirm")},A=()=>P("cancel"),F=()=>{const e=t.cancelButtonText||$("cancel");return v("button",{type:"button",class:[K("cancel"),N],onClick:A},[n.cancel?n.cancel():e])},J=()=>{const e=t.confirmButtonText||$("confirm");return v("button",{type:"button",class:[K("confirm"),N],onClick:E},[n.confirm?n.confirm():e])},L=()=>{if(t.showToolbar){const e=n.toolbar||n.default;return v("div",{class:K("toolbar")},[e?e():[F(),n.title?n.title():t.title?v("div",{class:[K("title"),"van-ellipsis"]},[t.title]):void 0,J()]])}},Y=()=>a.value.map(((o,a)=>{var i;return v(M,{textKey:s,readonly:t.readonly,allowHtml:t.allowHtml,className:o.className,itemHeight:d.value,defaultIndex:null!=(i=o.defaultIndex)?i:+t.defaultIndex,swipeDuration:t.swipeDuration,initialOptions:o[l],visibleItemCount:t.visibleItemCount,onChange:()=>(t=>{"cascade"===m.value&&y(t),"plain"===m.value?e("change",k(0),S(0)):e("change",j(),t)})(a)},{option:n.option})})),z=t=>{if(o.value){const e={height:`${d.value}px`},n={backgroundSize:`100% ${(t-d.value)/2}px`};return[v("div",{class:K("mask"),style:n},null),v("div",{class:[V,K("frame")],style:e},null)]}},G=()=>{const e=d.value*+t.visibleItemCount,n={height:`${e}px`};return v("div",{class:K("columns"),style:n,onTouchmove:h},[Y(),z(e)])};return p((()=>t.columns),(()=>{const{columns:e}=t;"plain"===m.value?a.value=[{[l]:e}]:"cascade"===m.value?(()=>{var e;const n=[];let o={[i]:t.columns};for(;o&&o[i];){const a=o[i];let s=null!=(e=o.defaultIndex)?e:+t.defaultIndex;for(;a[s]&&a[s].disabled;){if(!(s<a.length-1)){s=0;break}s++}n.push({[l]:o[i],className:o.className,defaultIndex:s}),o=a[s]}a.value=n})():a.value=e,o.value=a.value.some((t=>t[l]&&0!==t[l].length))}),{immediate:!0}),f({confirm:E,getValues:j,setValues:t=>{t.forEach(((t,e)=>{O(e,t)}))},getIndexes:x,setIndexes:t=>{t.forEach(((t,e)=>{D(e,t)}))},getColumnIndex:S,setColumnIndex:D,getColumnValue:k,setColumnValue:O,getColumnValues:t=>{const e=T(t);if(e)return e.state.options},setColumnValues:b}),()=>{var e,o;return v("div",{class:K()},["top"===t.toolbarPosition?L():null,t.loading?v(H,{class:K("loading")},null):null,null==(e=n["columns-top"])?void 0:e.call(n),G(),null==(o=n["columns-bottom"])?void 0:o.call(n),"bottom"===t.toolbarPosition?L():null])}}});export{P as p,E as s};
