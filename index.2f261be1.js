import{g as e,h as t,r as a,o,Z as l,N as r,d as n,ag as s,l as i,q as u,e as c,aV as d,H as f,ak as m,n as p,a6 as v,ao as h,m as g,t as y,k as D,aW as w,s as b,a8 as k,aO as x,x as T,a5 as S,Y as M,aX as O,j as A,a as C,c as B,b as Y,f as H,az as R,w as W}from"./index.1d359d94.js";import{B as j}from"./index.05a56d39.js";import{p as F}from"./index.19a43f25.js";/* empty css              */import{h as P}from"./moment.cc41a62b.js";import{u as I}from"./use-refs.a16310f5.js";const[z,N,V]=e("calendar");function $(e,t){const a=e.getFullYear(),o=t.getFullYear();if(a===o){const a=e.getMonth(),o=t.getMonth();return a===o?0:a>o?1:-1}return a>o?1:-1}function _(e,t){const a=$(e,t);if(0===a){const a=e.getDate(),o=t.getDate();return a===o?0:a>o?1:-1}return a}const q=e=>new Date(e),E=e=>Array.isArray(e)?e.map(q):q(e);function L(e,t){const a=q(e);return a.setDate(a.getDate()+t),a}const U=e=>L(e,-1),X=e=>L(e,1),Z=()=>{const e=new Date;return e.setHours(0,0,0,0),e};t({},F,{filter:Function,columnsOrder:Array,formatter:{type:Function,default:(e,t)=>t}});const[G]=e("calendar-day");var J=n({name:G,props:{item:s(Object),color:String,index:Number,offset:i(0),rowHeight:String},emits:["click"],setup(e,{emit:t,slots:a}){const o=u((()=>{var t;const{item:a,index:o,color:l,offset:r,rowHeight:n}=e,s={height:n};if("placeholder"===a.type)return s.width="100%",s;if(0===o&&(s.marginLeft=100*r/7+"%"),l)switch(a.type){case"end":case"start":case"start-end":case"multiple-middle":case"multiple-selected":s.background=l;break;case"middle":s.color=l}return r+((null==(t=a.date)?void 0:t.getDate())||1)>28&&(s.marginBottom=0),s})),l=()=>{"disabled"!==e.item.type&&t("click",e.item)},r=()=>{const{topInfo:t}=e.item;if(t||a["top-info"])return c("div",{class:N("top-info")},[a["top-info"]?a["top-info"](e.item):t])},n=()=>{const{bottomInfo:t}=e.item;if(t||a["bottom-info"])return c("div",{class:N("bottom-info")},[a["bottom-info"]?a["bottom-info"](e.item):t])},s=()=>{const{item:t,color:a,rowHeight:o}=e,{type:l,text:s}=t,i=[r(),s,n()];return"selected"===l?c("div",{class:N("selected-day"),style:{width:o,height:o,background:a}},[i]):i};return()=>{const{type:t,className:a}=e.item;return"placeholder"===t?c("div",{class:N("day"),style:o.value},null):c("div",{role:"gridcell",style:o.value,class:[N("day",t),a],tabindex:"disabled"===t?void 0:-1,onClick:l},[s()])}}});const[K]=e("calendar-month");var Q=n({name:K,props:{date:s(Date),type:String,color:String,minDate:s(Date),maxDate:s(Date),showMark:Boolean,rowHeight:p,formatter:Function,lazyRender:Boolean,currentDate:[Date,Array],allowSameDay:Boolean,showSubtitle:Boolean,showMonthTitle:Boolean,firstDayOfWeek:Number},emits:["click","update-height"],setup(e,{emit:t,slots:n}){const[s,i]=d(),p=a(),g=a(),y=(e=>{const t=a(),n=()=>{t.value=r(e).height};return o((()=>{l(n),setTimeout(n,100)})),t})(g),D=u((()=>{return t=e.date,V("monthTitle",t.getFullYear(),t.getMonth()+1);var t})),w=u((()=>f(e.rowHeight))),b=u((()=>{const t=e.date.getDay();return e.firstDayOfWeek?(t+7-e.firstDayOfWeek)%7:t})),k=u((()=>{return t=e.date.getFullYear(),a=e.date.getMonth()+1,32-new Date(t,a-1,32).getDate();var t,a})),x=u((()=>s.value||!e.lazyRender)),T=t=>{const{type:a,minDate:o,maxDate:l,currentDate:r}=e;if(_(t,o)<0||_(t,l)>0)return"disabled";if(null===r)return"";if(Array.isArray(r)){if("multiple"===a)return(t=>{const a=t=>e.currentDate.some((e=>0===_(e,t)));if(a(t)){const e=U(t),o=X(t),l=a(e),r=a(o);return l&&r?"multiple-middle":l?"end":r?"start":"multiple-selected"}return""})(t);if("range"===a)return(t=>{const[a,o]=e.currentDate;if(!a)return"";const l=_(t,a);if(!o)return 0===l?"start":"";const r=_(t,o);return e.allowSameDay&&0===l&&0===r?"start-end":0===l?"start":0===r?"end":l>0&&r<0?"middle":""})(t)}else if("single"===a)return 0===_(t,r)?"selected":"";return""},S=t=>{if("range"===e.type){if("start"===t||"end"===t)return V(t);if("start-end"===t)return`${V("start")}/${V("end")}`}},M=()=>{if(e.showMonthTitle)return c("div",{class:N("month-title")},[D.value])},O=()=>{if(e.showMark&&x.value)return c("div",{class:N("month-mark")},[e.date.getMonth()+1])},A=u((()=>{const e=Math.ceil((k.value+b.value)/7);return Array(e).fill({type:"placeholder"})})),C=u((()=>{const t=[],a=e.date.getFullYear(),o=e.date.getMonth();for(let l=1;l<=k.value;l++){const r=new Date(a,o,l),n=T(r);let s={date:r,type:n,text:l,bottomInfo:S(n)};e.formatter&&(s=e.formatter(s)),t.push(s)}return t})),B=u((()=>C.value.filter((e=>"disabled"===e.type)))),Y=(a,o)=>c(J,{item:a,index:o,color:e.color,offset:b.value,rowHeight:w.value,onClick:e=>t("click",e)},h(n,["top-info","bottom-info"]));return m({getTitle:()=>D.value,getHeight:()=>y.value,setVisible:i,scrollToDate:(e,t)=>{if(p.value){const a=r(p.value),o=A.value.length,l=(Math.ceil((t.getDate()+b.value)/7)-1)*a.height/o;v(e,a.top+l+e.scrollTop-r(e).top)}},disabledDays:B}),()=>c("div",{class:N("month"),ref:g},[M(),c("div",{ref:p,role:"grid",class:N("days")},[O(),(x.value?C:A).value.map(Y)])])}});const[ee]=e("calendar-header");var te=n({name:ee,props:{title:String,subtitle:String,showTitle:Boolean,showSubtitle:Boolean,firstDayOfWeek:Number},emits:["click-subtitle"],setup(e,{slots:t,emit:a}){const o=()=>{if(e.showTitle){const a=e.title||V("title"),o=t.title?t.title():a;return c("div",{class:N("header-title")},[o])}},l=e=>a("click-subtitle",e),r=()=>{if(e.showSubtitle){const a=t.subtitle?t.subtitle():e.subtitle;return c("div",{class:N("header-subtitle"),onClick:l},[a])}},n=()=>{const{firstDayOfWeek:t}=e,a=V("weekdays"),o=[...a.slice(t,7),...a.slice(0,t)];return c("div",{class:N("weekdays")},[o.map((e=>c("span",{class:N("weekday")},[e])))])};return()=>c("div",{class:N("header")},[o(),r(),n()])}});const ae=A(n({name:z,props:{show:Boolean,type:g("single"),title:String,color:String,round:y,readonly:Boolean,poppable:y,maxRange:D(null),position:g("bottom"),teleport:[String,Object],showMark:y,showTitle:y,formatter:Function,rowHeight:p,confirmText:String,rangePrompt:String,lazyRender:y,showConfirm:y,defaultDate:[Date,Array],allowSameDay:Boolean,showSubtitle:y,closeOnPopstate:y,showRangePrompt:y,confirmDisabledText:String,closeOnClickOverlay:y,safeAreaInsetTop:Boolean,safeAreaInsetBottom:y,minDate:{type:Date,validator:w,default:Z},maxDate:{type:Date,validator:w,default:()=>{const e=Z();return new Date(e.getFullYear(),e.getMonth()+6,e.getDate())}},firstDayOfWeek:{type:p,default:0,validator:e=>e>=0&&e<=6}},emits:["select","confirm","unselect","month-show","over-range","update:show","click-subtitle"],setup(e,{emit:t,slots:o}){const l=(t,a=e.minDate,o=e.maxDate)=>-1===_(t,a)?a:1===_(t,o)?o:t,n=(t=e.defaultDate)=>{const{type:a,minDate:o,maxDate:r}=e;if(null===t)return t;const n=Z();if("range"===a){Array.isArray(t)||(t=[]);return[l(t[0]||n,o,U(r)),l(t[1]||n,X(o))]}return"multiple"===a?Array.isArray(t)?t.map((e=>l(e))):[l(n)]:(t&&!Array.isArray(t)||(t=n),l(t))};let s;const i=a(),d=a(""),f=a(n()),[p,v]=I(),g=u((()=>e.firstDayOfWeek?+e.firstDayOfWeek%7:0)),y=u((()=>{const t=[],a=new Date(e.minDate);a.setDate(1);do{t.push(new Date(a)),a.setMonth(a.getMonth()+1)}while(1!==$(a,e.maxDate));return t})),D=u((()=>{if(f.value){if("range"===e.type)return!f.value[0]||!f.value[1];if("multiple"===e.type)return!f.value.length}return!f.value})),w=()=>{const e=S(i.value),a=e+s,o=y.value.map(((e,t)=>p.value[t].getHeight()));if(a>o.reduce(((e,t)=>e+t),0)&&e>0)return;let l,r=0;const n=[-1,-1];for(let s=0;s<y.value.length;s++){const i=p.value[s];r<=a&&r+o[s]>=e&&(n[1]=s,l||(l=i,n[0]=s),p.value[s].showed||(p.value[s].showed=!0,t("month-show",{date:i.date,title:i.getTitle()}))),r+=o[s]}y.value.forEach(((e,t)=>{const a=t>=n[0]-1&&t<=n[1]+1;p.value[t].setVisible(a)})),l&&(d.value=l.getTitle())},A=e=>{T((()=>{y.value.some(((t,a)=>0===$(t,e)&&(i.value&&p.value[a].scrollToDate(i.value,e),!0))),w()}))},C=()=>{if(!e.poppable||e.show)if(f.value){const t="single"===e.type?f.value:f.value[0];A(t)}else T(w)},B=()=>{e.poppable&&!e.show||(T((()=>{s=Math.floor(r(i).height)})),C())},Y=(e=n())=>{f.value=e,C()},H=()=>{var e;return t("confirm",null!=(e=f.value)?e:E(f.value))},R=(a,o)=>{const l=e=>{f.value=e,t("select",E(e))};if(o&&"range"===e.type){const o=(a=>{const{maxRange:o,rangePrompt:l,showRangePrompt:r}=e;return!(o&&function(e){const t=e[0].getTime();return(e[1].getTime()-t)/864e5+1}(a)>o&&(r&&O(l||V("rangePrompt",o)),t("over-range"),1))})(a);if(!o)return void l([a[0],L(a[0],+e.maxRange-1)])}l(a),o&&!e.showConfirm&&H()},W=u((()=>p.value.reduce(((e,t)=>{var a,o;return e.push(...null!=(o=null==(a=t.disabledDays)?void 0:a.value)?o:[]),e}),[]))),F=a=>{if(e.readonly||!a.date)return;const{date:o}=a,{type:l}=e;if("range"===l){if(!f.value)return void R([o]);const[t,a]=f.value;if(t&&!a){const a=_(o,t);if(1===a){const e=((e,t,a)=>{var o;return null==(o=e.find((e=>-1===_(t,e.date)&&-1===_(e.date,a))))?void 0:o.date})(W.value,t,o);if(e){const a=U(e);-1===_(t,a)?R([t,a]):R([o])}else R([t,o],!0)}else-1===a?R([o]):e.allowSameDay&&R([o,o],!0)}else R([o])}else if("multiple"===l){if(!f.value)return void R([o]);const a=f.value,l=a.findIndex((e=>0===_(e,o)));if(-1!==l){const[e]=a.splice(l,1);t("unselect",q(e))}else e.maxRange&&a.length>=e.maxRange?O(e.rangePrompt||V("rangePrompt",e.maxRange)):R([...a,o])}else R(o,!0)},P=e=>t("update:show",e),z=(t,a)=>{const l=0!==a||!e.showSubtitle;return c(Q,M({ref:v(a),date:t,currentDate:f.value,showMonthTitle:l,firstDayOfWeek:g.value},h(e,["type","color","minDate","maxDate","showMark","formatter","rowHeight","lazyRender","showSubtitle","allowSameDay"]),{onClick:F}),h(o,["top-info","bottom-info"]))},G=()=>{if(o.footer)return o.footer();if(e.showConfirm){const t=o["confirm-text"],a=D.value,l=a?e.confirmDisabledText:e.confirmText;return c(j,{round:!0,block:!0,type:"danger",color:e.color,class:N("confirm"),disabled:a,nativeType:"button",onClick:H},{default:()=>[t?t({disabled:a}):l||V("confirm")]})}},J=()=>c("div",{class:N()},[c(te,{title:e.title,subtitle:d.value,showTitle:e.showTitle,showSubtitle:e.showSubtitle,firstDayOfWeek:g.value,"onClick-subtitle":e=>t("click-subtitle",e)},h(o,["title","subtitle"])),c("div",{ref:i,class:N("body"),onScroll:w},[y.value.map(z)]),c("div",{class:[N("footer"),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[G()])]);return b((()=>e.show),B),b((()=>[e.type,e.minDate,e.maxDate]),(()=>Y(n(f.value)))),b((()=>e.defaultDate),((e=null)=>{f.value=e,C()})),m({reset:Y,scrollToDate:A}),k(B),()=>e.poppable?c(x,{show:e.show,class:N("popup"),round:e.round,position:e.position,closeable:e.showTitle||e.showSubtitle,teleport:e.teleport,closeOnPopstate:e.closeOnPopstate,safeAreaInsetTop:e.safeAreaInsetTop,closeOnClickOverlay:e.closeOnClickOverlay,"onUpdate:show":P},{default:J}):J()}}));const oe={class:""},le=Y("br",null,null,-1),re=H("选择单个日期"),ne=Y("br",null,null,-1),se=H("选择多个日期"),ie=n({setup(e){const t=a(!1),o=a(!1),l=a(""),r=a(""),n=e=>{t.value=!1,l.value=P(e).format("YYYY-MM-DD")},s=e=>{o.value=!1;const t=e.map((e=>P(e).format("YYYY-MM-DD"))).join();e.value=t};return(e,a)=>{const i=j,u=ae;return C(),B("div",oe,[Y("div",null,[H(R("单个日期时间是："+l.value)+" ",1),le,c(i,{type:"primary",onClick:a[0]||(a[0]=e=>t.value=!0)},{default:W((()=>[re])),_:1}),c(u,{show:t.value,onConfirm:n},null,8,["show"])]),Y("div",null,[H(R("选择多个时间分别是："+r.value)+" ",1),ne,c(i,{type:"primary",onClick:a[1]||(a[1]=e=>o.value=!0)},{default:W((()=>[se])),_:1}),c(u,{show:o.value,type:"multiple",onConfirm:s},null,8,["show"])])])}}});export{ie as default};
