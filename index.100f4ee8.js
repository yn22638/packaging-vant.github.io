import{aD as e,aE as a,aF as t,ar as r,z as l,S as n,g as o,n as i,m as s,k as u,h as c,aG as d,at as g,d as p,aa as m,r as f,au as v,aH as h,q as b,H as y,ak as k,av as x,aI as w,s as C,Z as S,o as M,e as F,$ as V,T as I,aJ as B,I as T,p as A,Y as $,f as z,aK as P,j as E}from"./index.4d8fa731.js";function H(e,a){return(!a.required||!function(e){return Array.isArray(e)?!e.length:0!==e&&!e}(e))&&!(a.pattern&&!a.pattern.test(String(e)))}function W(e,t){const{message:r}=t;return a(r)?r(e,t):r||""}function j({target:e}){e.composing=!0}function q({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function L(e){return[...e].length}let D=0;function K(){const e=n(),{name:a="unknown"}=(null==e?void 0:e.type)||{};return`${a}-${++D}`}const[O,G]=o("field");const J=E(p({name:O,props:c({},d,{id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:i,formatter:Function,clearIcon:s("clear"),modelValue:u(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,enterkeyhint:String,clearTrigger:s("focus"),formatTrigger:s("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},{rows:i,type:s("text"),rules:Array,autosize:[Boolean,Object],labelWidth:i,labelClass:g,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}}),emits:["blur","focus","clear","keypress","click-input","click-left-icon","click-right-icon","update:modelValue"],setup(a,{emit:n,slots:o}){const i=K(),s=m({focused:!1,validateFailed:!1,validateMessage:""}),u=f(),c=f(),{parent:d}=v(h),g=()=>{var e;return String(null!=(e=a.modelValue)?e:"")},p=e=>I(a[e])?a[e]:d&&I(d.props[e])?d.props[e]:void 0,E=b((()=>{const e=p("readonly");if(a.clearable&&!e){const e=""!==g(),t="always"===a.clearTrigger||"focus"===a.clearTrigger&&s.focused;return e&&t}return!1})),D=b((()=>c.value&&o.input?c.value():a.modelValue)),O=a=>a.reduce(((a,t)=>a.then((()=>{if(s.validateFailed)return;let{value:a}=D;return t.formatter&&(a=t.formatter(a,t)),H(a,t)?t.validator?function(a,t){return new Promise((r=>{const l=t.validator(a,t);e(l)?l.then(r):r(l)}))}(a,t).then((e=>{e&&"string"==typeof e?(s.validateFailed=!0,s.validateMessage=e):!1===e&&(s.validateFailed=!0,s.validateMessage=W(a,t))})):void 0:(s.validateFailed=!0,void(s.validateMessage=W(a,t)))}))),Promise.resolve()),J=()=>{s.validateFailed&&(s.validateFailed=!1,s.validateMessage="")},Y=(e=a.rules)=>new Promise((t=>{J(),e?O(e).then((()=>{s.validateFailed?t({name:a.name,message:s.validateMessage}):t()})):t()})),Z=e=>{if(d&&a.rules){const t=d.props.validateTrigger===e,r=a.rules.filter((a=>a.trigger?a.trigger===e:t));r.length&&Y(r)}},N=(e,t="onChange")=>{if(e=(e=>{const{maxlength:t}=a;if(I(t)&&L(e)>t){const a=g();return a&&L(a)===+t?a:function(e,a){return[...e].slice(0,a).join("")}(e,+t)}return e})(e),"number"===a.type||"digit"===a.type){const t="number"===a.type;e=B(e,t,t)}a.formatter&&t===a.formatTrigger&&(e=a.formatter(e)),u.value&&u.value.value!==e&&(u.value.value=e),e!==a.modelValue&&n("update:modelValue",e)},Q=e=>{e.target.composing||N(e.target.value)},R=()=>{var e;return null==(e=u.value)?void 0:e.blur()},U=()=>{const e=u.value;"textarea"===a.type&&a.autosize&&e&&function(e,a){const n=t();e.style.height="auto";let o=e.scrollHeight;if(l(a)){const{maxHeight:e,minHeight:t}=a;void 0!==e&&(o=Math.min(o,e)),void 0!==t&&(o=Math.max(o,t))}o&&(e.style.height=`${o}px`,r(n))}(e,a.autosize)},X=e=>{s.focused=!0,n("focus",e),S(U),p("readonly")&&R()},_=e=>{p("readonly")||(s.focused=!1,N(g(),"onBlur"),n("blur",e),Z("onBlur"),S(U),P())},ee=e=>n("click-input",e),ae=e=>n("click-left-icon",e),te=e=>n("click-right-icon",e),re=e=>{A(e),n("update:modelValue",""),n("clear",e)},le=b((()=>"boolean"==typeof a.error?a.error:!!(d&&d.props.showError&&s.validateFailed)||void 0)),ne=b((()=>{const e=p("labelWidth");if(e)return{width:y(e)}})),oe=e=>{if(13===e.keyCode){d&&d.props.submitOnEnter||"textarea"===a.type||A(e),"search"===a.type&&R()}n("keypress",e)},ie=()=>a.id||`${i}-input`,se=()=>{const e=G("control",[p("inputAlign"),{error:le.value,custom:!!o.input,"min-height":"textarea"===a.type&&!a.autosize}]);if(o.input)return F("div",{class:e,onClick:ee},[o.input()]);const t={id:ie(),ref:u,name:a.name,rows:void 0!==a.rows?+a.rows:void 0,class:e,value:a.modelValue,disabled:p("disabled"),readonly:p("readonly"),autofocus:a.autofocus,placeholder:a.placeholder,autocomplete:a.autocomplete,enterkeyhint:a.enterkeyhint,"aria-labelledby":a.label?`${i}-label`:void 0,onBlur:_,onFocus:X,onInput:Q,onClick:ee,onChange:q,onKeypress:oe,onCompositionend:q,onCompositionstart:j};return"textarea"===a.type?F("textarea",t,null):F("input",$("number"===(r=a.type)?{type:"text",inputmode:"decimal"}:"digit"===r?{type:"tel",inputmode:"numeric"}:{type:r},t),null);var r},ue=()=>{const e=o["right-icon"];if(a.rightIcon||e)return F("div",{class:G("right-icon"),onClick:te},[e?e():F(T,{name:a.rightIcon,classPrefix:a.iconPrefix},null)])},ce=()=>{if(a.showWordLimit&&a.maxlength){const e=L(g());return F("div",{class:G("word-limit")},[F("span",{class:G("word-num")},[e]),z("/"),a.maxlength])}},de=()=>{if(d&&!1===d.props.showErrorMessage)return;const e=a.errorMessage||s.validateMessage;if(e){const a=o["error-message"],t=p("errorMessageAlign");return F("div",{class:G("error-message",t)},[a?a({message:e}):e])}},ge=()=>[F("div",{class:G("body")},[se(),E.value&&F(T,{name:a.clearIcon,class:G("clear"),onTouchstart:re},null),ue(),o.button&&F("div",{class:G("button")},[o.button()])]),ce(),de()];return k({blur:R,focus:()=>{var e;return null==(e=u.value)?void 0:e.focus()},validate:Y,formValue:D,resetValidation:J}),x(w,{customValue:c,resetValidation:J,validateWithTrigger:Z}),C((()=>a.modelValue),(()=>{N(g()),J(),Z("onChange"),S(U)})),M((()=>{N(g(),a.formatTrigger),S(U)})),()=>{const e=p("disabled"),t=p("labelAlign"),r=(()=>{const e=p("colon")?":":"";return o.label?[o.label(),e]:a.label?F("label",{id:`${i}-label`,for:ie()},[a.label+e]):void 0})(),l=(()=>{const e=o["left-icon"];if(a.leftIcon||e)return F("div",{class:G("left-icon"),onClick:ae},[e?e():F(T,{name:a.leftIcon,classPrefix:a.iconPrefix},null)])})();return F(V,{size:a.size,icon:a.leftIcon,class:G({error:le.value,disabled:e,[`label-${t}`]:t}),center:a.center,border:a.border,isLink:a.isLink,clickable:a.clickable,titleStyle:ne.value,valueClass:G("value"),titleClass:[G("label",[t,{required:a.required}]),a.labelClass],arrowDirection:a.arrowDirection},{icon:l?()=>l:null,title:r?()=>r:null,value:ge,extra:o.extra})}}}));export{J as F,K as u};
